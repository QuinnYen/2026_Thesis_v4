# å¥å­ç´šåˆ¥ HMAC-Net ä½¿ç”¨æŒ‡å—

æœ¬æŒ‡å—èªªæ˜å¦‚ä½•ä½¿ç”¨ HMAC-Net é€²è¡Œå¥å­ç´šåˆ¥ï¼ˆSentence-Levelï¼‰çš„æƒ…æ„Ÿåˆ†æã€‚

---

## ğŸ¯ æ ¸å¿ƒå‰µæ–°

### ç‚ºä»€éº¼é€™å€‹æ–¹æ³•å‰µæ–°ï¼Ÿ

å‚³çµ±çš„å¥å­ç´šåˆ¥æƒ…æ„Ÿåˆ†æï¼š
```
Text â†’ BERT â†’ [CLS] token â†’ Classifier â†’ Label
```

**æˆ‘å€‘çš„æ–¹æ³•ï¼ˆä¿ç•™ PMAC å’Œ IARM å‰µæ–°ï¼‰ï¼š**
```
Text â†’ BERT â†’ Implicit Aspect Discovery â†’ PMAC â†’ IARM â†’ Classifier â†’ Label
                â†“
         è‡ªå‹•ç™¼ç¾ 5 å€‹éš±å«çš„èªç¾©é¢å‘
         (ä¾‹å¦‚ï¼šæƒ…ç¯€ã€æ¼”æŠ€ã€æŠ€è¡“ã€æƒ…æ„Ÿç­‰)
```

**å„ªå‹¢ï¼š**
- âœ… ä¿ç•™åŸæœ‰çš„ PMAC å’Œ IARM å‰µæ–°æ¨¡çµ„
- âœ… å¯è§£é‡‹æ€§ï¼šå¯è¦–åŒ–æ¨¡å‹ç™¼ç¾äº†å“ªäº›èªç¾©é¢å‘
- âœ… é€šç”¨æ€§ï¼šé©ç”¨æ–¼ä»»ä½•æ–‡æœ¬åˆ†é¡ä»»å‹™

---

## ğŸ“¦ ç³»çµ±æ¶æ§‹

```
data/
â”œâ”€â”€ dataset_config.json          # è³‡æ–™é›†é…ç½®æª”æ¡ˆï¼ˆç®¡ç†æ‰€æœ‰è³‡æ–™é›†ï¼‰
â”œâ”€â”€ dataset_manager.py           # è³‡æ–™é›†ç®¡ç†å™¨
â”œâ”€â”€ sentence_level_dataset.py    # å¥å­ç´šåˆ¥è³‡æ–™è¼‰å…¥å™¨
â””â”€â”€ semeval_multiaspect.py       # Aspect-based è³‡æ–™è¼‰å…¥å™¨

models/
â”œâ”€â”€ implicit_aspect_discovery.py # éš±å«é¢å‘ç™¼ç¾æ¨¡çµ„ï¼ˆæ–°ï¼‰
â”œâ”€â”€ hmacnet_sentence_level.py    # å¥å­ç´šåˆ¥ HMAC-Netï¼ˆæ–°ï¼‰
â”œâ”€â”€ pmac_selective.py            # Selective PMACï¼ˆå·²ä¿®æ­£ gate çµ±è¨ˆï¼‰
â”œâ”€â”€ pmac_enhanced.py             # å‚³çµ± PMAC
â””â”€â”€ iarm_enhanced.py             # IARM

experiments/
â”œâ”€â”€ train_sentence_level.py      # å¥å­ç´šåˆ¥è¨“ç·´è…³æœ¬ï¼ˆæ–°ï¼‰
â””â”€â”€ train_multiaspect.py         # Aspect-based è¨“ç·´è…³æœ¬
```

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. æŸ¥çœ‹å¯ç”¨çš„è³‡æ–™é›†

```bash
python data/dataset_manager.py list
```

è¼¸å‡ºç¯„ä¾‹ï¼š
```
å¯ç”¨çš„è³‡æ–™é›†:
================================================================================
  [âœ“] semeval_rest         - SemEval-2014 Restaurant
  [âœ—] imdb                 - IMDB Movie Reviews
  [âœ—] sst2                 - Stanford Sentiment Treebank (Binary)
  [âœ—] yelp                 - Yelp Reviews
  ...
```

### 2. æŸ¥çœ‹ç‰¹å®šè³‡æ–™é›†çš„è©³ç´°è³‡è¨Š

```bash
python data/dataset_manager.py info --dataset imdb
```

### 3. æ¸¬è©¦è³‡æ–™é›†è¼‰å…¥

```bash
python data/dataset_manager.py test --dataset semeval_rest --limit 10
```

---

## ğŸ“š æ”¯æ´çš„è³‡æ–™é›†

### Aspect-Based è³‡æ–™é›†ï¼ˆæœ‰æ˜ç¢º aspect æ¨™è¨»ï¼‰

| ä»£è™Ÿ | åç¨± | é ˜åŸŸ | é¡åˆ¥æ•¸ |
|------|------|------|--------|
| `semeval_rest` | SemEval-2014 Restaurant | é¤å»³è©•è«– | 3 |
| `semeval_laptop` | SemEval-2014 Laptop | ç”¢å“è©•è«– | 3 |

**è¨“ç·´å‘½ä»¤ï¼š**
```bash
python experiments/train_multiaspect.py --use_pmac --pmac_mode selective --use_iarm
```

### Sentence-Level è³‡æ–™é›†ï¼ˆç„¡ aspect æ¨™è¨»ï¼‰

| ä»£è™Ÿ | åç¨± | é ˜åŸŸ | é¡åˆ¥æ•¸ |
|------|------|------|--------|
| `imdb` | IMDB Movie Reviews | é›»å½±è©•è«– | 2 |
| `sst2` | Stanford Sentiment Treebank | é›»å½±è©•è«– | 2 |
| `yelp` | Yelp Reviews | é¤å»³è©•è«– | 2 |
| `amazon` | Amazon Product Reviews | ç”¢å“è©•è«– | 5 |

**è¨“ç·´å‘½ä»¤ï¼š**
```bash
# ä½¿ç”¨ IMDB è³‡æ–™é›†
python experiments/train_sentence_level.py --dataset imdb --use_pmac --use_iarm

# ä½¿ç”¨ SST-2 è³‡æ–™é›†
python experiments/train_sentence_level.py --dataset sst2 --use_pmac --pmac_mode selective --use_iarm

# å¿«é€Ÿæ¸¬è©¦ï¼ˆé™åˆ¶æ¨£æœ¬æ•¸ï¼‰
python experiments/train_sentence_level.py --dataset imdb --use_pmac --use_iarm --limit 1000
```

---

## ğŸ”§ æ·»åŠ è‡ªå®šç¾©è³‡æ–™é›†

### æ–¹æ³• 1ï¼šä½¿ç”¨ CSV æ ¼å¼

1. æº–å‚™ CSV æª”æ¡ˆï¼ˆåŒ…å« `text` å’Œ `label` æ¬„ä½ï¼‰ï¼š
```csv
text,label
"This movie is great!",2
"Terrible film.",0
"It was okay.",1
```

2. åœ¨ `data/dataset_config.json` ä¸­æ·»åŠ é…ç½®ï¼š
```json
{
  "my_dataset": {
    "name": "My Custom Dataset",
    "type": "sentence_level",
    "domain": "generic",
    "paths": {
      "train": "data/raw/my_dataset/train.csv",
      "test": "data/raw/my_dataset/test.csv"
    },
    "format": "csv",
    "text_column": "text",
    "label_column": "label",
    "num_classes": 3,
    "label_names": ["negative", "neutral", "positive"]
  }
}
```

3. è¨“ç·´æ¨¡å‹ï¼š
```bash
python experiments/train_sentence_level.py --dataset my_dataset --use_pmac --use_iarm
```

### æ–¹æ³• 2ï¼šä½¿ç”¨ JSON æ ¼å¼

1. æº–å‚™ JSON Lines æª”æ¡ˆï¼š
```json
{"text": "This movie is great!", "label": 2}
{"text": "Terrible film.", "label": 0}
{"text": "It was okay.", "label": 1}
```

2. åœ¨é…ç½®ä¸­æ·»åŠ ï¼š
```json
{
  "my_json_dataset": {
    "name": "My JSON Dataset",
    "type": "sentence_level",
    "domain": "movie_review",
    "paths": {
      "train": "data/raw/my_dataset/train.json",
      "test": "data/raw/my_dataset/test.json"
    },
    "format": "json",
    "text_key": "text",
    "label_key": "label",
    "num_classes": 2,
    "label_names": ["negative", "positive"]
  }
}
```

---

## âš™ï¸ è¨“ç·´åƒæ•¸èªªæ˜

### åŸºæœ¬åƒæ•¸

```bash
--dataset <code>              # è³‡æ–™é›†ä»£è™Ÿï¼ˆå¿…å¡«ï¼‰
--batch_size 16               # Batch size
--epochs 20                   # è¨“ç·´è¼ªæ•¸
--lr 2e-5                     # å­¸ç¿’ç‡
--limit 1000                  # é™åˆ¶æ¨£æœ¬æ•¸ï¼ˆå¿«é€Ÿæ¸¬è©¦ç”¨ï¼‰
```

### æ¨¡å‹åƒæ•¸

```bash
--num_implicit_aspects 5      # éš±å« aspects æ•¸é‡
--use_pmac                    # å•Ÿç”¨ PMAC
--pmac_mode selective         # PMAC æ¨¡å¼ï¼šselectiveï¼ˆæ¨è–¦ï¼‰ã€sequentialã€pairwiseã€attention
--use_iarm                    # å•Ÿç”¨ IARM
--iarm_mode transformer       # IARM æ¨¡å¼ï¼štransformerã€gatã€bilinear
--fusion_strategy weighted_pooling  # èåˆç­–ç•¥ï¼šweighted_poolingï¼ˆæ¨è–¦ï¼‰ã€meanã€maxã€attention
```

### å®Œæ•´ç¯„ä¾‹

```bash
# æœ€æ¨è–¦çš„é…ç½®ï¼ˆä½¿ç”¨æ‰€æœ‰å‰µæ–°æ¨¡çµ„ï¼‰
python experiments/train_sentence_level.py \
  --dataset imdb \
  --use_pmac \
  --pmac_mode selective \
  --use_iarm \
  --iarm_mode transformer \
  --num_implicit_aspects 5 \
  --fusion_strategy weighted_pooling \
  --batch_size 16 \
  --epochs 20 \
  --lr 2e-5

# Baselineï¼ˆä¸ä½¿ç”¨ PMAC å’Œ IARMï¼‰
python experiments/train_sentence_level.py \
  --dataset imdb \
  --batch_size 16 \
  --epochs 20

# å¿«é€Ÿæ¸¬è©¦
python experiments/train_sentence_level.py \
  --dataset imdb \
  --use_pmac \
  --use_iarm \
  --limit 500 \
  --epochs 3
```

---

## ğŸ“Š å¯¦é©—çµæœèªªæ˜

è¨“ç·´å®Œæˆå¾Œï¼Œçµæœæœƒä¿å­˜åœ¨ `results/sentence_level/<timestamp>_<exp_name>/`ï¼š

```
results/sentence_level/20250112_123456_imdb_pmac_iarm/
â”œâ”€â”€ checkpoints/
â”‚   â””â”€â”€ best_model_epoch10_f1_0.8756.pt
â”œâ”€â”€ reports/
â”‚   â”œâ”€â”€ experiment_results.json      # è©³ç´°çµæœï¼ˆJSONï¼‰
â”‚   â””â”€â”€ experiment_summary.txt       # å¯¦é©—æ‘˜è¦ï¼ˆæ–‡å­—ï¼‰
â””â”€â”€ visualizations/
    â””â”€â”€ (å¯è¦–åŒ–åœ–è¡¨)
```

---

## ğŸ” èˆ‡ Baseline æ¯”è¼ƒ

### å°æ¯”å¯¦é©—è¨­è¨ˆ

ç‚ºäº†è­‰æ˜ PMAC å’Œ IARM çš„æœ‰æ•ˆæ€§ï¼Œå»ºè­°é€²è¡Œæ¶ˆèå¯¦é©—ï¼š

```bash
# 1. Full Modelï¼ˆæ‰€æœ‰å‰µæ–°ï¼‰
python experiments/train_sentence_level.py --dataset imdb --use_pmac --use_iarm

# 2. No PMAC
python experiments/train_sentence_level.py --dataset imdb --use_iarm

# 3. No IARM
python experiments/train_sentence_level.py --dataset imdb --use_pmac

# 4. Baselineï¼ˆç„¡å‰µæ–°æ¨¡çµ„ï¼‰
python experiments/train_sentence_level.py --dataset imdb

# 5. ä¸åŒçš„ PMAC æ¨¡å¼
python experiments/train_sentence_level.py --dataset imdb --use_pmac --pmac_mode sequential --use_iarm
python experiments/train_sentence_level.py --dataset imdb --use_pmac --pmac_mode selective --use_iarm
```

### çµæœæ¯”è¼ƒè¡¨æ ¼ç¯„ä¾‹

| æ¨¡å‹ | Accuracy | F1 | èªªæ˜ |
|------|----------|-----|------|
| Baseline | 0.850 | 0.845 | ç„¡ PMACã€ç„¡ IARM |
| + PMAC (selective) | 0.862 | 0.858 | åŠ å…¥ Selective PMAC |
| + IARM | 0.868 | 0.864 | åŠ å…¥ IARM |
| Full Model | **0.875** | **0.871** | PMAC + IARM |

---

## ğŸ§ª å¯è§£é‡‹æ€§åˆ†æ

æ¨¡å‹æœƒè‡ªå‹•ç™¼ç¾éš±å«çš„èªç¾©é¢å‘ï¼Œä¾‹å¦‚å°æ–¼é›»å½±è©•è«–ï¼ˆIMDBï¼‰ï¼š

```python
# é å®šç¾©çš„èªç¾©é¢å‘ï¼ˆé‡å°é›»å½±è©•è«–ï¼‰
aspects = [
    "overall impression",    # æ•´é«”å°è±¡
    "story and plot",       # æ•…äº‹æƒ…ç¯€
    "acting performance",   # æ¼”æŠ€è¡¨ç¾
    "technical quality",    # æŠ€è¡“å“è³ªï¼ˆæ”å½±ã€ç‰¹æ•ˆç­‰ï¼‰
    "emotional impact"      # æƒ…æ„Ÿå½±éŸ¿
]
```

æ¯å€‹ aspect æœƒè‡ªå‹•å­¸ç¿’é—œæ³¨æ–‡æœ¬ä¸­çš„ç›¸é—œéƒ¨åˆ†ã€‚

---

## â“ å¸¸è¦‹å•é¡Œ

### Q1: æˆ‘çš„è³‡æ–™é›†æ²’æœ‰ aspect æ¨™è¨»ï¼Œå¯ä»¥ä½¿ç”¨å—ï¼Ÿ
**A:** å¯ä»¥ï¼é€™æ­£æ˜¯å¥å­ç´šåˆ¥ HMAC-Net çš„ç›®çš„ã€‚ç³»çµ±æœƒè‡ªå‹•ç™¼ç¾éš±å«çš„èªç¾©é¢å‘ã€‚

### Q2: éš±å« aspects çš„æ•¸é‡å¦‚ä½•é¸æ“‡ï¼Ÿ
**A:** å»ºè­° 3-7 å€‹ã€‚å¯ä»¥å˜—è©¦ä¸åŒæ•¸é‡ï¼š
```bash
--num_implicit_aspects 3  # å°‘é‡ aspects
--num_implicit_aspects 5  # æ¨è–¦
--num_implicit_aspects 7  # è¼ƒå¤š aspects
```

### Q3: æˆ‘æ‡‰è©²ä½¿ç”¨å“ªç¨® PMAC æ¨¡å¼ï¼Ÿ
**A:** æ¨è–¦ `selective`ï¼ˆå¯å­¸ç¿’çš„ gateï¼‰ã€‚å°æ¯”ï¼š
- `selective`: è‡ªé©æ‡‰çµ„åˆï¼ˆæ¨è–¦ï¼‰
- `sequential`: é †åºçµ„åˆ
- `pairwise`: æˆå°çµ„åˆ
- `attention`: æ³¨æ„åŠ›çµ„åˆ

### Q4: å¦‚ä½•èˆ‡ç´” BERT baseline æ¯”è¼ƒï¼Ÿ
**A:** è¨“ç·´ä¸ä½¿ç”¨ PMAC å’Œ IARM çš„ç‰ˆæœ¬ï¼š
```bash
python experiments/train_sentence_level.py --dataset imdb
```

### Q5: å¯ä»¥ä½¿ç”¨å…¶ä»– BERT æ¨¡å‹å—ï¼Ÿ
**A:** å¯ä»¥ï¼
```bash
--bert_model bert-base-uncased
--bert_model roberta-base
--bert_model xlm-roberta-base
```

---

## ğŸ“ è«–æ–‡æ’°å¯«å»ºè­°

### æ–¹æ³•è«–éƒ¨åˆ†

**æ¨™é¡Œï¼š** Implicit Aspect Discovery for Sentence-Level Sentiment Analysis

**èªªæ˜ï¼š**
1. å‚³çµ±å¥å­ç´šåˆ¥æ–¹æ³•çš„å±€é™æ€§
2. æˆ‘å€‘çš„å‰µæ–°ï¼šè‡ªå‹•ç™¼ç¾éš±å«çš„èªç¾©é¢å‘
3. å¦‚ä½•ä¿ç•™ PMAC å’Œ IARM å‰µæ–°ä¸¦æ‡‰ç”¨åˆ°å¥å­ç´šåˆ¥ä»»å‹™

### å¯¦é©—éƒ¨åˆ†

**æ¶ˆèå¯¦é©—è¡¨æ ¼ï¼š**
| Model Variant | IMDB | SST-2 | Yelp |
|--------------|------|-------|------|
| BERT Baseline | X.XX | X.XX | X.XX |
| + Implicit Aspects | X.XX | X.XX | X.XX |
| + PMAC | X.XX | X.XX | X.XX |
| + IARM | X.XX | X.XX | X.XX |
| Full Model | **X.XX** | **X.XX** | **X.XX** |

**å¯è§£é‡‹æ€§åˆ†æï¼š**
- å¯è¦–åŒ–æ¯å€‹éš±å« aspect é—œæ³¨çš„è©å½™
- åˆ†æä¸åŒé ˜åŸŸï¼ˆé›»å½±ã€é¤å»³ã€ç”¢å“ï¼‰çš„ aspect åˆ†ä½ˆ

---

## ğŸ“ å¼•ç”¨

å¦‚æœæ‚¨åœ¨ç ”ç©¶ä¸­ä½¿ç”¨äº†æœ¬ç³»çµ±ï¼Œå»ºè­°å¼•ç”¨ï¼š

```
æˆ‘å€‘æå‡ºäº†ä¸€ç¨®å‰µæ–°çš„æ–¹æ³•ï¼Œå°‡åŸæœ¬ç”¨æ–¼ aspect-based æƒ…æ„Ÿåˆ†æçš„ PMAC å’Œ IARM æ¨¡çµ„
æ“´å±•åˆ°å¥å­ç´šåˆ¥ä»»å‹™ã€‚é€šééš±å«é¢å‘ç™¼ç¾æ©Ÿåˆ¶ï¼ˆImplicit Aspect Discoveryï¼‰ï¼Œ
æ¨¡å‹èƒ½å¤ è‡ªå‹•è­˜åˆ¥æ–‡æœ¬ä¸­çš„èªç¾©é¢å‘ï¼Œä¸¦åˆ©ç”¨ PMAC é€²è¡Œé¢å‘çµ„åˆã€
IARM å»ºæ¨¡é¢å‘é–“çš„é—œä¿‚ï¼Œæœ€çµ‚å¯¦ç¾æ›´ç´°ç·»çš„å¥å­ç´šåˆ¥æƒ…æ„Ÿåˆ†æã€‚
```

---

**ç¥æ‚¨å¯¦é©—é †åˆ©ï¼** ğŸ‰
